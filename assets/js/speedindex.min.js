var RUMSpeedIndex=function(e){e=e||window;var t=e.document,r=function(r){var n=!1;if(r.getBoundingClientRect){var i=r.getBoundingClientRect();n={top:Math.max(i.top,0),left:Math.max(i.left,0),bottom:Math.min(i.bottom,e.innerHeight||t.documentElement.clientHeight),right:Math.min(i.right,e.innerWidth||t.documentElement.clientWidth)},n.bottom<=n.top||n.right<=n.left?n=!1:n.area=(n.bottom-n.top)*(n.right-n.left)}return n},n=function(e,t){if(t){var n=r(e);n&&f.push({url:t,area:n.area,rect:n})}},i=function(){for(var i=t.getElementsByTagName("*"),a=/url\(.*(http.*)\)/gi,o=0;o<i.length;o++){var m=i[o],c=e.getComputedStyle(m);if("IMG"==m.tagName&&n(m,m.src),c["background-image"]){a.lastIndex=0;var s=a.exec(c["background-image"]);s&&s.length>1&&n(m,s[1].replace('"',""))}if("IFRAME"==m.tagName)try{var g=r(m);if(g){var h=RUMSpeedIndex(m.contentWindow);h&&f.push({tm:h,area:g.area,rect:g})}}catch(e){}}},a=function(){for(var t={},r=e.performance.getEntriesByType("resource"),n=0;n<r.length;n++)t[r[n].name]=r[n].responseEnd;for(var i=0;i<f.length;i++)"tm"in f[i]||(f[i].tm=void 0!==t[f[i].url]?t[f[i].url]:0)},o=function(){if("msFirstPaint"in e.performance.timing&&(g=e.performance.timing.msFirstPaint-d),"chrome"in e&&"loadTimes"in e.chrome){var r=e.chrome.loadTimes();if("firstPaintTime"in r&&r.firstPaintTime>0){var n=r.startLoadTime;"requestTime"in r&&(n=r.requestTime),r.firstPaintTime>=n&&(g=1e3*(r.firstPaintTime-n))}}if(void 0===g||g<0||g>12e4){g=e.performance.timing.responseStart-d;for(var i={},a=t.getElementsByTagName("head")[0].children,o=0;o<a.length;o++){var m=a[o];"SCRIPT"==m.tagName&&m.src&&!m.async&&(i[m.src]=!0),"LINK"==m.tagName&&"stylesheet"==m.rel&&m.href&&(i[m.href]=!0)}for(var c=e.performance.getEntriesByType("resource"),f=!1,s=0;s<c.length;s++)if(f||!i[c[s].name]||"script"!=c[s].initiatorType&&"link"!=c[s].initiatorType)f=!0;else{var h=c[s].responseEnd;(void 0===g||h>g)&&(g=h)}}g=Math.max(g,0)},m=function(){for(var r={0:0},n=0,i=0;i<f.length;i++){var a=g;"tm"in f[i]&&f[i].tm>g&&(a=f[i].tm),void 0===r[a]&&(r[a]=0),r[a]+=f[i].area,n+=f[i].area}var o=Math.max(t.documentElement.clientWidth,e.innerWidth||0)*Math.max(t.documentElement.clientHeight,e.innerHeight||0);if(o>0&&(o=Math.max(o-n,0)*l,void 0===r[g]&&(r[g]=0),r[g]+=o,n+=o),n){for(var m in r)r.hasOwnProperty(m)&&s.push({tm:m,area:r[m]});s.sort(function(e,t){return e.tm-t.tm});for(var c=0,h=0;h<s.length;h++)c+=s[h].area,s[h].progress=c/n}},c=function(){if(s.length){h=0;for(var e=0,t=0,r=0;r<s.length;r++){var n=s[r].tm-e;n>0&&t<1&&(h+=(1-t)*n),e=s[r].tm,t=s[r].progress}}else h=g},f=[],s=[],g,h,l=.1;try{var d=e.performance.timing.navigationStart;i(),a(),o(),m(),c()}catch(e){}return h};"undefined"!=typeof module&&module.exports&&(module.exports=RUMSpeedIndex);